<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stock Manager Futuristic - Order Status</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
body {
    background: linear-gradient(145deg, #a0c4ff, #bdb2ff, #ffc6ff);
    color: #000;
    font-family: 'Inter', sans-serif;
    margin-bottom: 70px;
}
.card {
    border-radius: 20px;
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
.section { display: none; padding-bottom: 10px; }
.show { display: block; }

.bottom-nav {
    position: fixed; bottom:0; width:100%; height:60px;
    background-color: rgba(255,255,255,0.9);
    display:flex; justify-content:space-around; align-items:center;
    border-top:1px solid #ccc; z-index:999;
}
.bottom-nav button { background:none; border:none; flex-direction:column; font-size:12px; color:#555; display:flex; align-items:center;}
.bottom-nav button.active { color:#0d6efd; font-weight:bold; }

.filter-btn.active { background:#0d6efd; color:#fff; }
.total-box { font-size:20px; font-weight:bold; color:#198754; }
</style>
</head>
<body>

<div class="container py-3">
<h2 class="text-center mb-3">ðŸ“¦ Stock Barang ku</h2>

<!-- Tambah Produk -->
<div class="section card p-3" id="addProduct">
<h5>Tambah / Edit Produk</h5>
<form id="productForm">
<input type="hidden" id="editIndex">
<input type="text" id="name" class="form-control mb-2" placeholder="Nama Barang" required>
<input type="number" id="price" class="form-control mb-2" placeholder="Harga" required>
<input type="number" id="stock" class="form-control mb-2" placeholder="Stok Awal" required>
<button class="btn w-100" style="background:linear-gradient(90deg,#00ffcc,#0099ff);color:#000;">Simpan Produk</button>
</form>
</div>

<!-- Catat Penjualan -->
<div class="section card p-3" id="saleProduct">
<h5>Catat Penjualan</h5>
<form id="saleForm">
<input type="text" id="buyerName" class="form-control mb-2" placeholder="Nama Pembeli" required>
<select id="productSelect" class="form-select mb-2"></select>
<input type="number" id="qty" class="form-control mb-2" placeholder="Jumlah Terjual" required>
<button class="btn w-100" style="background:linear-gradient(90deg,#00ffcc,#0099ff);color:#000;">Catat Penjualan</button>
</form>
</div>

<!-- Daftar Produk -->
<div class="section card p-3" id="productList">
<h5>Daftar Produk</h5>
<div class="table-responsive">
<table class="table table-bordered text-center">
<thead><tr><th>Nama</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr></thead>
<tbody id="productTable"></tbody>
</table>
</div>
</div>

<!-- History -->
<div class="section" id="historyChart">

<div class="card p-3 mb-3">
<h5>Riwayat Transaksi</h5>
<div class="table-responsive">
<table class="table table-striped text-center">
<thead><tr><th>Waktu</th><th>Pembeli</th><th>Produk</th><th>Jumlah</th><th>Total</th></tr></thead>
<tbody id="historyTable"></tbody>
</table>
</div>
</div>

<div class="card p-3 mb-3 text-center">
<div class="total-box">Total Pendapatan: Rp <span id="revenue">0</span></div>
</div>

<!-- ORDER -->
<div class="card p-3 mb-3">
<h5>Barang Dalam Proses / Order</h5>

<div class="mb-2">
<button class="btn btn-sm btn-outline-primary filter-btn active" onclick="filterOrders('pending', this)">Memesan</button>
<button class="btn btn-sm btn-outline-success filter-btn" onclick="filterOrders('sold', this)">Terjual</button>
<button class="btn btn-sm btn-outline-danger filter-btn" onclick="filterOrders('canceled', this)">Batal Beli</button>
</div>

<div class="table-responsive">
<table class="table table-bordered text-center">
<thead><tr><th>Produk</th><th>Pembeli</th><th>Jumlah</th><th>Status</th><th>Aksi</th></tr></thead>
<tbody id="orderTable"></tbody>
</table>
</div>
</div>

<div class="card p-3">
<h5>ðŸ“Š Grafik Penjualan</h5>
<canvas id="salesChart"></canvas>
</div>

</div>
</div>

<div class="bottom-nav">
<button onclick="switchTab('addProduct',this)" class="active"><i class="bi bi-plus-circle"></i>Tambah</button>
<button onclick="switchTab('saleProduct',this)"><i class="bi bi-cart-check"></i>Jual</button>
<button onclick="switchTab('productList',this)"><i class="bi bi-box-seam"></i>Produk</button>
<button onclick="switchTab('historyChart',this)"><i class="bi bi-bar-chart"></i>Riwayat</button>
</div>

<script>
const state={
products:JSON.parse(localStorage.getItem("products"))||[],
revenue:parseInt(localStorage.getItem("revenue"))||0,
history:JSON.parse(localStorage.getItem("history"))||[],
orders:JSON.parse(localStorage.getItem("orders"))||[]
};

let chart;
let currentFilter="pending";

function save(){
localStorage.setItem("products",JSON.stringify(state.products));
localStorage.setItem("revenue",state.revenue);
localStorage.setItem("history",JSON.stringify(state.history));
localStorage.setItem("orders",JSON.stringify(state.orders));
}

function switchTab(id,btn){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("show"));
document.getElementById(id).classList.add("show");
document.querySelectorAll(".bottom-nav button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
}

function filterOrders(status,btn){
currentFilter=status;
document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
render();
}

function render(){

// Produk
const productTable=document.getElementById("productTable");
const productSelect=document.getElementById("productSelect");
productTable.innerHTML="";
productSelect.innerHTML="";
state.products.forEach((p,i)=>{
productTable.innerHTML+=`
<tr>
<td>${p.name}</td>
<td>Rp ${p.price.toLocaleString()}</td>
<td>${p.stock}</td>
<td>
<button class="btn btn-warning btn-sm" onclick="editProduct(${i})">Edit</button>
<button class="btn btn-danger btn-sm" onclick="deleteProduct(${i})">Hapus</button>
</td>
</tr>`;
productSelect.innerHTML+=`<option value="${i}">${p.name}</option>`;
});

// History
const historyTable=document.getElementById("historyTable");
historyTable.innerHTML="";
state.history.forEach(h=>{
historyTable.innerHTML+=`
<tr>
<td>${h.time}</td>
<td>${h.buyer}</td>
<td>${h.name}</td>
<td>${h.qty}</td>
<td>Rp ${h.total.toLocaleString()}</td>
</tr>`;
});

// Order
const orderTable=document.getElementById("orderTable");
orderTable.innerHTML="";
state.orders
.map((o,i)=>({...o,index:i}))
.filter(o=>o.status===currentFilter)
.forEach(o=>{
let badge="";
if(o.status==="pending") badge='<span class="badge bg-primary">Memesan</span>';
if(o.status==="sold") badge='<span class="badge bg-success">Terjual</span>';
if(o.status==="canceled") badge='<span class="badge bg-danger">Batal Beli</span>';

orderTable.innerHTML+=`
<tr>
<td>${o.name}</td>
<td>${o.buyer}</td>
<td>${o.qty}</td>
<td>${badge}</td>
<td>
${o.status==="pending"?
`<button class="btn btn-success btn-sm" onclick="markSold(${o.index})">Terjual</button>
<button class="btn btn-danger btn-sm" onclick="markCanceled(${o.index})">Batal</button>`
:"-"}
</td>
</tr>`;
});

document.getElementById("revenue").textContent=state.revenue.toLocaleString();
updateChart();
}

function markSold(i){
state.orders[i].status="sold";
save(); render();
}

function markCanceled(i){
const order=state.orders[i];

// kurangi revenue
state.revenue-=order.total;

// kembalikan stok
const product=state.products.find(p=>p.name===order.name);
if(product){ product.stock+=order.qty; }

state.orders[i].status="canceled";
save(); render();
}

function updateChart(){
const dataCount={};
state.orders.filter(o=>o.status==="sold").forEach(o=>{
if(!dataCount[o.name]) dataCount[o.name]=0;
dataCount[o.name]+=o.qty;
});
if(chart) chart.destroy();
chart=new Chart(document.getElementById("salesChart"),{
type:"bar",
data:{labels:Object.keys(dataCount),
datasets:[{label:"Terjual",data:Object.values(dataCount),backgroundColor:"rgba(0,255,204,0.7)"}]},
options:{responsive:true}
});
}

document.getElementById("productForm").onsubmit=function(e){
e.preventDefault();
const name=document.getElementById("name").value.trim();
const price=parseInt(document.getElementById("price").value);
const stock=parseInt(document.getElementById("stock").value);
const editIndex=document.getElementById("editIndex").value;

if(editIndex==="") state.products.push({name,price,stock});
else state.products[editIndex]={name,price,stock};

this.reset();
document.getElementById("editIndex").value="";
save(); render();
};

document.getElementById("saleForm").onsubmit=function(e){
e.preventDefault();
const i=document.getElementById("productSelect").value;
const qty=parseInt(document.getElementById("qty").value);
const buyer=document.getElementById("buyerName").value.trim();

if(state.products[i].stock<qty){alert("Stok tidak cukup!");return;}

state.products[i].stock-=qty;
const total=state.products[i].price*qty;
state.revenue+=total;

state.history.unshift({time:new Date().toLocaleString(),buyer,name:state.products[i].name,qty,total});
state.orders.unshift({buyer,name:state.products[i].name,qty,total,status:"pending"});

this.reset();
save(); render();
};

function editProduct(i){
const p=state.products[i];
document.getElementById("name").value=p.name;
document.getElementById("price").value=p.price;
document.getElementById("stock").value=p.stock;
document.getElementById("editIndex").value=i;
switchTab('addProduct',document.querySelectorAll(".bottom-nav button")[0]);
}

function deleteProduct(i){
if(confirm("Hapus produk?")){
state.products.splice(i,1);
save(); render();
}
}

switchTab('addProduct',document.querySelectorAll(".bottom-nav button")[0]);
render();
</script>

</body>
</html>
